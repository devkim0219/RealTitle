{% extends "base.html" %}

{% block title %}
기사 분석
{% endblock %}

{% block content %}
<div class="bradcam_area">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="bradcam_text text-center">
                    <h3># 기사 키워드 시각화</h3>
                </div>
            </div>
        </div>
    </div>
</div>
<section class="blog_area single-post-area section-padding">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 posts-list">
                <div class="single-post">
                    <div class="blog_details">
                        <h4><strong>기사 내용</strong></h4>
                        <!-- <p class="excert"> -->
                        <textarea id="input-data", name="article_content"  autofocus=True, rows=10, placeholder='기사 내용을 입력해주세요.', style="margin: 0px 1px 0px 0px; width:100%; height:437px; font-size: 14px;"></textarea>
                        <div class="row justify-content-between">
                            <input class="send_text_btn col-sm-2 btn btn-primary" type="button" value="시작", style="margin: 0px 15px 10px 15px;"; />
                            <span id="checkTextArea", class="col-sm-2 text-right" style="padding: 0px 10px 0px 5px;">0 / 2000</span>
                        </div>
                        <div class="raw">
                            <div>
                                <table id="wordcount" class="table table-bordered">
                                    <thead class="text-center">
                                        <tr>
                                            <th width=10%>구분</th>
                                            <th width=80%>단어</th>
                                            <th width=10%>빈도</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                    </tbody>
                                </table>
                            </div>
                            <img id="wordCloud" src="" alt="" style="width:600px;">
                        </div>
                        <!-- </p> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
{% block script %}
<script type="text/javascript">
    /**
    * 글자수(바이트 체크)
    * @param oid : 글자를 받을 Textarea ID
    * @param tid : 바이트 체크된 값 리턴될 엘리먼트 ID
    */
    function pubByteCheckTextarea(oid,tid){
        $(oid).on("keyup",function(){
            var limitLength = 2000
            var byteTxt = "";
            var byte = function(str){
                var byteNum=0;
                for(i=0;i<str.length;i++){
                    byteNum+=(str.charCodeAt(i)>127)?2:1;
                    if(byteNum<500){
                        byteTxt+=str.charAt(i);
                    };
                };
                return Math.round( byteNum/2 );
            };
            if(byte($(this).val())>limitLength){
                alert("2000자 이상 입력할수 없습니다.");
                $(this).val("");
                $(this).val(byteTxt);
            }else{
                $(tid).html( byte($(this).val()) + " / " + limitLength )
            }
        });
    };
    // 글자수 세기 스타트
    pubByteCheckTextarea( $("#input-data"), $("#checkTextArea") )

    $(function(){
        $('.send_text_btn').click(function(e){
            e.preventDefault();
            var textData = $('#input-data');
            $.ajax({
                url:'/aritcle_keyword_visualization/'
                ,type:'post'
                ,dataType:'json'
                ,data: textData.serialize()
                ,success:function(result){
                    $("#wordcount tbody").empty();
                    // alert(result['wordCount'][0])
                    $.each(result['wordCount'], function( index, counter ){
                        // console.log(this);
                        var dicts = counter
                        // console.log(typeof(counter), counter)
                        var word = dicts[0]
                        var count = dicts[1]
                        $("#wordcount tbody").append(
                            "<tr><td>" + (index + 1) + "</td><td>" + word + "</td><td>" + count + "</td></tr>"
                        )
                    })
                    $('#wordCloud').attr("src", result['wordcloudURI']);
                },
                error:function(result){
                    alert('')
                }
            });
        });
    });

    
</script>
{% endblock %}
