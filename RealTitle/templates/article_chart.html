{% extends "base.html" %}

{% block title %}
기사 검색 & 키워드 트렌드 시각화
{% endblock %}

{% block content %}
<div class="bradcam_area mybradcam_area">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <style>
                    @import url('https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&display=swap');
                </style>
                <div class="bradcam_text text-center">
                    <h3>키워드 트렌드</h3>
                </div>
            </div>
        </div>
    </div>
</div>
<section class="blog_area section-padding">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 mb-5 mb-lg-0">
                <h3># 기사 상세 검색</h3>
                <div class="form-group">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="search_keyword" placeholder='키워드를 입력하세요.' onfocus="this.placeholder = ''" onblur="this.placeholder = '키워드를 입력하세요.'">
                    </div>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="start_date" placeholder='시작 날짜를 입력하세요. ex)20200508' onfocus="this.placeholder = ''" onblur="this.placeholder = '시작 날짜를 입력하세요. ex)20200508'">
                    </div>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="end_date" placeholder='종료 날짜를 입력하세요. ex)20200508' onfocus="this.placeholder = ''" onblur="this.placeholder = '종료 날짜를 입력하세요. ex)20200508'">    
                    </div>
                    <button id ="search_btn" class="btn" type="button"><i class="ti-search">&nbsp;검색</i></button>
                </div>
                <h3># 키워드 트렌드</h3>
            </div>
            <div style="width: 600px; height: 400px;">
                <canvas id="myChart" width="600px" height="400px"></canvas>
            </div>
        </div>
    </div>
</section>
<div class="wrap-loading display-none">
    <div class="loading-container">
        <div class="loading"></div>
        <div id="loading-text">loading</div>
    </div>                                                                                                                                                                                                                                                                                                                                       
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
$('#search_btn').click(function() {
    var search_keyword = $('#search_keyword').val()
    var start_date = $('#start_date').val()
    var end_date = $('#end_date').val()

    $.ajax({
        type: 'POST',
        url: "{% url 'article_chart' %}",
        data: {
            search_keyword: search_keyword,
            start_date: start_date,
            end_date: end_date
            // 'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        dataType: 'json',
        success: function(data) {
            // alert("data -> " + data)
            var ctx = $("#myChart").get(0).getContext("2d");
            new Chart(ctx, {
                type: 'line',
                data: data,
            });
        },
        beforeSend:function(){
            $('.wrap-loading').removeClass('display-none')
        },
        complete:function(){
            $('.wrap-loading').addClass('display-none')
        },
        error: function(request, error) {
            alert('전송 실패...')
        }
    })
})
</script>
{% endblock %}